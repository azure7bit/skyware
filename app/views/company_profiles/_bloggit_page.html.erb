<div class="row">

  <div id="primary" class="col-sm-12">
    <div class="content">    
      <header class="header">
        <hgroup>
          <h1 class="site-title text-center">
            <center style="position: absolute;">
            <a rel="home" title="<%= "#{@user.subdomain.capitalize}" %>" href="/">
              <strong style="color: #235A9F;"><%= "#{@user.subdomain.capitalize}" rescue "Bussines" %></strong>
            </a>
            </center>
          </h1>
          <% if current_user == @user %>
            <div id='create-new-post-btn' class="btn btn-primary pull-right" style="margin-top: 3px;">
              <i class="fa fa-pencil-square-o"></i>
            </div>
          <% elsif current_user %>
            <div id='create-new-post-btn' class="btn btn-primary pull-right" style="margin-top: 3px;">
              <i class="fa fa-pencil-square-o"></i>
            </div>
          <% end %>
        </hgroup>
      </header> 

       <% if current_user == @user %>
        <section class='new-post post' style="display:none">
          <div class="form-post-content">
            <%= form_for Blogit::Post.new, url: post_save_path do |f| %>
              <div class="form-group">
                <%= f.label :title, "Topic" %>
                <%= f.text_field :title, class: "form-control", :required => true %>
              </div>
              <div class="form-group">
                <%= f.label :title, "Tags" %>
                <%= f.text_field :tag_list, class: "form-control", :required => true %>
              </div>
              <div class="form-group">
                <%= f.label :title, "Post Content" %>
                <%= f.text_area :body, class: "form-control", rows: "5", :required => true %>
              </div>
              <div class="form-group">
                  <%= f.check_box :post_type %>Is Sticky Post
                </div>
              <%= f.submit "Create Post", class: "btn btn-success", :id => "button-new-post" %>
              <button type="reset" class="btn btn-warning post-cancel" id="cancel-post">Cancel</button>
            <% end %>
          </div>
        </section>
        <% else %>
        <section class='new-post post' style="display:none">
          <div class="form-post-content">
            <%= render 'conversations/new_direct_message' %>
          </div>
        </section>
      <% end %>

      <p class="text-muted">
        <% @sticky_posts.each_with_index do |post, i| %>
        <section class="post" id="new-post-<%= post.id %>" >
          <% if current_user == @user %>
            <div class="btn-group entry-button pull-right">
              <a href="" class="dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-chevron-down"></i>
              </a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="#" class="sticky-edit" data-id="<%= post.id %>">Edit</a></li>
                <li class="divider"></li>
                <li><%= link_to "Delete", delete_post_path(post.id), method: :delete, data: { confirm: 'Are you sure?' } %></li>
              </ul>
            </div>
          <% end %>
          <div class="sticky-content" data-id="<%= post.id %>" id="more-less">
            <header class="entry-header">
              <% url = @user.avatar.blank? ? "img/profile-placeholder.png" : @user.avatar.url %>
              <%= image_tag url , :height => "52", :width => "52", class: "entry-avatar" %>
              <h2 class="entry-title">
                <a href="#" id="title-post-<%= i %>" data-id = "<%= post.id %>">
                <strong><%= post.title %></strong></a>
              </h2>
              <p class="entry-meta">
                By <a class="entry-author" href="#"><%= post.blogger.subdomain%></a> | Tags 
                <% post.dollar_tags.each do |tag| %>
                  <a class="label label-success" href="#"><%= tag.name %></a>
                <% end %>
                <% post.non_dollar_tags.each do |tag| %>
                  <a class="label label-danger" href="#"><%= tag.name %></a>
                <% end %>
              </p>
            </header>
            <div class="entry-description comment more"><%= post.body%></div>
          </div>
          <div class="form-sticky-content" data-id="<%= post.id %>" hidden="true">
            <%= form_for post, url: company_edit_post_path(post.id, @user.id, @user.class) do |f| %>
              <div class="form-group">
                <%= f.label :title, "Topic" %>
                <%= f.text_field :title, class: "form-control", :id => "title_post_#{post.id}" %>
              </div>
              <div class="form-group">
                <%= f.label :title, "Tags" %>
                <%= f.text_field :tag_list, class: "form-control" %>
              </div>
              <div class="form-group">
                <%= f.label :title, "Post Content" %>
                <%= f.text_area :body, class: "form-control", rows: "5" %>
              </div>
              <div class="form-group">
                <%= f.check_box :post_type %> Is Sticky Post
              </div>
              <%= f.submit "Change Post", class: "btn btn-success" %>
              <button type="button" class="btn btn-warning sticky-cancel" data-id="<%= post.id %>">Cancel</button>
            <% end %>
          </div>
        </section>
        <% end %>
      </p>

      <% if @posts.present? %>
        <% @posts.each_with_index do |post, i| %>
          <section class="post" id="new-post-<%= post.id %>">
            <!-- Single button -->
            <% if current_user == @user %>
              <div class="btn-group entry-button pull-right">
                <a href="" class="dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-chevron-down"></i>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#" class="post-reply" data-id="<%= post.id %>">Reply</a></li>
                  <li class="divider"></li>
                  <li><a href="#" class="post-edit" data-id="<%= post.id %>">Edit</a></li>
                  <li class="divider"></li>
                  <li><%= link_to "Delete", delete_post_path(post.id), method: :delete, data: { confirm: 'Are you sure?' } %></li>
                </ul>
              </div>
            <% end %>
            <div class="post-content" data-id="<%= post.id %>">
              <header class="entry-header">
                <% url = @user.avatar.blank? ? "img/profile-placeholder.png" : @user.avatar.url %>
                <%= image_tag url , :height => "52", :width => "52", class: "entry-avatar" %>
                <h2 class="entry-title">
                  <a href="#" id="title-post-<%= i %>" data-id = "<%= post.id %>">
                  <strong><%= post.title %></strong></a>
                </h2>
                <p class="entry-meta">
                  Posted on <a class="entry-date" href="#"><%= post.created_at.strftime("%B %d, %Y")%></a> | By <a class="entry-author" href="#"><%= post.blogger.subdomain%></a> | Tags 
                  <% post.dollar_tags.each do |tag| %>
                    <a class="label label-success" href="#"><%= tag.name %></a>
                  <% end %>
                  <% post.non_dollar_tags.each do |tag| %>
                    <a class="label label-danger" href="#"><%= tag.name %></a>
                  <% end %>
                </p>
              </header>
              <div class="entry-description comment more"><%= post.body%></div>
              <% if post.comments.any? %>
                <%= link_to "Comment(#{post.comments.count})", "#", :class => "comment-post" %>
                <% post.comments.reverse.each do |comment| %>
                  <div class="post-content post-comment" data-id="<%= post.id %>" hidden="true">
                    <p class="entry-meta comment-list">
                      <div class="entry-description comment more" ><%= comment.body %></div>
                      Posted on <a class="entry-date" href="#"><%= "#{time_ago_in_words(comment.created_at.strftime("%B %d, %Y"))} ago"%></a> | By <a class="entry-author" href="#"><%= comment.name %></a>
                    </p>
                  </div>
                <% end %>
              <% end %>
              <div class="reply" data-id="<%= post.id %>" hidden="true">
                <% if current_user %>
                <%= form_for post, url: reply_comment_path(post.id), method: :post do |f| %>
                  <%= f.submit "Replay", class: "btn btn-success pull-right btn_reply" %>
                  <br /><br />
                  <div class="form-group">
                    <%= text_area_tag :reply, nil, class: "form-control", rows: "5", :placeholder => "MESSAGE CONTENT" %>
                  </div>
                <% end %>
                <% end %>
              </div>
            </div>
            <div class="form-post-content" data-id="<%= post.id %>" hidden="true">
              <%= form_for post, url: company_edit_post_path(post.id, @user.id, @user.class) do |f| %>
                <div class="form-group">
                  <%= f.label :title, "Topic" %>
                  <%= f.text_field :title, class: "form-control", :id => "title_post_#{post.id}" %>
                </div>
                <div class="form-group">
                  <%= f.label :title, "Tags" %>
                  <%= f.text_field :tag_list, class: "form-control" %>
                </div>
                <div class="form-group">
                  <%= f.label :title, "Post Content" %>
                  <%= f.text_area :body, class: "form-control", rows: "5" %>
                </div>
                <div class="form-group">
                  <%= f.check_box :post_type %> Is Sticky Post
                </div>
                <%= f.submit "Change Post", class: "btn btn-success" %>
                <button type="button" class="btn btn-warning post-cancel" data-id="<%= post.id %>">Cancel</button>
              <% end %>
            </div>
            <% if @user != current_user && !current_user.blank? %>
              <%= render 'conversations/comment_conversation_form', title: post.title, commentor: current_user, recipient: @user %>
            <% end %>
          </section> <!-- /.post -->
        <% end %>
      <% else %>
        <%= render partial: "blogit/posts/empty" %>
      <% end %>
    </div>
    <div class="content">
      <div class="post-content">
        <div class="row">
          <div class="col-sm-12"></div>
          <div class="col-sm-1"></div>
          <div class="col-sm-10">
            <%= paginate @posts %>
          </div>
          <div class="col-sm-1"></div>
          <%# if @sticky_posts.any? %>
<!--             <br />
            <div class="pull-left">
              <i id="back-top" class="fa fa-arrow-circle-up"> <a href="#">Go To Sticky</a></i>
            </div>
            <br /> -->
          <%# end %>
        </div>
      </div>
    </div>
      <footer class="footer">
        <p>Â© SkyHQ 2014. All right reserved.</p>
        <div class="socials-footer">
          <% [:facebook, :twitter, :linkedin, :flickr, :pinterest, :tumblr, :dropbox, :google_plus, :instagram, :github, :bitbucket, :vk].each do |s| %>
            <% if @user.send(s).present? %>
              <% class_name = s.to_s.gsub('_','-') %>
              <a class="btn btn-<%= class_name %>" href="<%= @user.send(s) %>" title="<%= s.to_s.titleize %>">
                <i class="fa fa-<%= class_name %>"></i>
              </a>
            <% end %>
          <% end %>
        </div> <!-- /.socials-footer -->
      </footer> <!-- /footer -->


  </div>
      
      
  </div> <!-- /#primary -->
</div>

  <%#= javascript_include_tag "blog/jquery-1.11.0.min" %>
  <%#= javascript_include_tag "blog/custom" %>
  <%#= javascript_include_tag "bootstrap" %>
  <%#= stylesheet_link_tag "blog/main" %>

<script type="text/javascript">
  <% if current_user.present? %>
    $(document).ready(function() {
      var get_id = $(".click").data("id");
        $(".click").editable("<%= company_tagline_path(:id => current_user.id, :subdomain => current_user.subdomain) %>.js", { 
        indicator : "<img src='/assets/assets/loader.gif'>",
        tooltip   : "Click to edit...",
        id        : 'save_tagline',
        style     : "inherit",
      });
      $(".editable_textile").editable("<%= company_tagline_path(:id => current_user.id, :subdomain => current_user.subdomain) %>", { 
        indicator : "<img src='/assets/assets/loader.gif'>",
        type      : "textarea",
        id        : 'save_tagline',
        name      : "tagline",
        submit    : "OK",
        cancel    : "Cancel",
        tooltip   : "Click to edit..."
      });

      for ( var i = 0; i < <%= @posts.count %>; i++ ) {
        $("#post-form-" + i).hide();
        $("button.post-edit-"+i).click(function(){
          $("#post-" + i).hide();
          $("#post-form-" + i).show();
        });
        $("button.post-edit-0").click(function(){
          $("#post-" + i).hide();
          $("#post-form-" + i).show();
        });
      }
        
      $( ".post-edit").click(function(e) {
        var id = $(this).data("id");
        $(".post-content[data-id='"+id+"']").hide("slow");
        $(".form-post-content[data-id='"+id+"']").show("slow");
        document.getElementById("title_post_"+id).focus();
        e.preventDefault();
      });

      $( ".sticky-edit").click(function(e) {
        var id =$(this).data("id");
        $(".sticky-content[data-id='"+id+"']").hide("slow");
        $(".form-sticky-content[data-id='"+id+"']").show("slow");
        document.getElementById("title_post_"+id).focus();
        e.preventDefault();
      });

      $( ".post-reply").click(function(e) {
        var id =$(this).data("id");
        $(".reply[data-id='"+id+"']").toggle();
        e.preventDefault();
      });

      $(".post-cancel").click(function() {
        var id =$(this).data("id");
        $(".post-content[data-id='"+id+"']").show("slow");
        $(".form-post-content[data-id='"+id+"']").hide("slow");
      });

      $(".sticky-cancel").click(function() {
        var id =$(this).data("id");
        $(".sticky-content[data-id='"+id+"']").show("slow");
        $(".form-sticky-content[data-id='"+id+"']").hide("slow");
      });

      var side_height = $("aside#left-panel").height();
      document.getElementById("main").style.minHeight = side_height+"px";

      var max_post_content = $('div.post-content').width();
      $('div.entry-description').css('max-width',max_post_content + "px");
    });
  <% end %>
  
  function checkFormVal(){
    var topic = $("#topic").val();
    var content = $("#content-post").val();

    if(topic != "" && content != ""){
     if(topic.length < 10 && content.length < 10){
      alert("Topic and Content are too short (minimum is 10 characters)..."); 
     }
     else if(topic.length < 10){
      alert("Topic is too short (minimum is 10 characters)..."); 
     }
     else if(content.length < 10) {
      alert("Content is too short (minimum is 10 characters)..."); 
     }
     else { $("#form-post").submit(); }
    }
    else if(topic=="" && content==""){
      alert("Topic and Content can not be blank...");
    }
    else if(topic==""){
      alert("Topic can not be blank...");
    }
    else{
      alert("Content can not be blank...");
    }
    return true;
  };

  $(document).ready(function() {
    var showChar = 355;
    var showChar2 = 200;
    var ellipsestext = "...";
    var moretext = "More";
    var lesstext = "Less";
    var max_post_content = $('div.post-content').width();
    $('.more').each(function() {
      var content = $(this).html();
      if(showChar < content.length) {
        if(hasWhiteSpace(content)){
          var c = content.substr(0, showChar2);
        }else{
          content = $.trim(content);
          var c = content.substr(0, showChar2/2);
        }

        var h = content.substr(showChar, content.length - showChar);

        var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="#more-less" class="morelink" id="less-page">' + moretext + '</a></span>';

        $(this).html(html);
      }
    });
    $('.more_about').each(function() {
      var content = $(this).html();
      if(showChar2 < content.length) {
        var c = content.substr(0, showChar2);
        var h = content.substr(showChar2-1, content.length - showChar2);

        var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="#" class="morelink">' + moretext + '</a></span>';

        $(this).html(html);
      }
    });
    $(".morelink").click(function(e){
      if($(this).hasClass("less")) {
        $(this).removeClass("less");
        $(this).html(moretext);
        e.preventDefault();
      } else {
        $(this).addClass("less");
        $(this).html(lesstext);
        e.preventDefault();
      }
      document.getElementById("main").style.Height = "auto";
      $(this).parent().prev().toggle();
      $(this).prev().toggle();
      return false;
      e.preventDefault();
    });

    $("#cancel-post").click(function(){
      $('#create-new-post-btn').click();
    });

    function hasWhiteSpace(s) {
      return /\s/g.test(s);
    }

    $('.comment-post').each(function(){
      $(this).click(function(e){
        $(this).parent('.post-content').find('.post-comment').attr('data-id',$(this).attr('data-id')).toggle();
        $(this).parent('.post-content').find('.reply').attr('data-id',$(this).attr('data-id')).toggle();
        e.preventDefault();
      });
    });

    $('ul.compose_message').show();

    $('.less').each(function(){
      $(this).click(function(){
        var side_height = $("aside#left-panel").height();
        document.getElementById("main").style.minHeight = side_height+"px";
        $content = $(this).closest('div.entry-description').prev();
        // $(this).closest('div.entry-description').focus();
        $content.focus();
        // e.preventDefault();
      });
    });

    $('#post_post_type').on("click", function(){
      if($("input:checked")){
        this.value = "Sticky";
      }else{
        this.value = null;
      }
    });

    // $('#goto-sticky').click(function(e){
    //   $('html, body').animate({scrollTop:$(document).height()}, 'slow');
    //   e.preventDefault();
    //   return false
    // });

    // $('#back-top').click(function(){
    //   $('html, body').animate({scrollTop:0}, 'slow');
    //   return false;
    // });

    $('#button-new-post').click(function(e){1
      var topic = $("#post_title").val();
      var body = $('#post_body').val();
      if(topic.length < 10 || body.length < 10){
        alert("Topic or Content are too short (minimum is 10 characters)...");
        e.stopPropagation();
        return false;
      }else{return true}
    });

  });
</script>